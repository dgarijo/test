<!DOCTYPE html>
<html lang="en">
  <!--
  /*
 * This page was created by Daniel Garijo.
 */
  -->
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Browse tools</title>

	
    <!-- Bootstrap -->
     <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet"/>
    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
	<script type="text/javascript">
			
			$(document).ready(function() {
				//loadTools();
			});
			
			function check() {
				$("#numberOfTools").html("");
				//console.log(document.getElementById("ontosoft").checked);
				if(document.getElementById("ontosoft").checked){
					//$("#labelOntosoft").html("Server 1 (Ontosoft) ("+loadTools("http://ontosoft.org/repository/software")+" tools)");
					loadTools("http://ontosoft.org/repository/software");
				}
				if(document.getElementById("c4p").checked){
					loadTools("http://c4p.ontosoft.org/repository/software");
				}
				if(document.getElementById("csdm").checked){
					loadTools("http://csdms.ontosoft.org/repository/software");
				}
			}
			
			
			function loadTools(uri) {
				var endpointURI =uri;
				//var endpointURI ="http://localhost:8080/ldp4j/ldp-bc/";
				// An ajax request that requests the above URI and parses the response. 
				$.ajax( {
					//contentType: "application/ld+json",
					//accepts: {jsonld: "application/ld+json"},
					//dataType :'jsonp',
					headers: {'Accept': 'application/ld+json'},
					//jsonp :'callback',
					url :endpointURI,
					success : function(json) {
						//console.log(json);
						console.log("Success!. Number of tools "+json.length);
						
						$("#numberOfTools").append(json.length+ " (from"+ endpointURI+"); ");
						loadToolMetadata(json);
						//return json.length;
					}
				}); 
			}
			/**
			* Function that loads the metadata of the tools and builds the html
			**/
			var toolsHtml='';//variable for storing incrementally the html of the table
			function loadToolMetadata(tool) {
				//_researchObjects=[];
				console.log(tool[0])
				for(var i = 0; i < tool.length; i++) {
					loadRow(tool[i]);
				}
				updateTable();
			}
			
			/*
			Function that updates the html variable for the table asynchronously
			*/
			function updateTable(){
				var html='<table class="col-sm-12">'+
					'<thead>'+
					'	<tr>'+
					'		<th data-field="id" class="col-sm-4">Name</th>'+
					'		<th data-field="name" class="col-sm-2">First author</th>'+
					'		<th data-field="price" class="col-sm-3">Type</th>'+
					'		<th data-field="license" class="col-sm-3">Description</th>'+
					'	</tr>'+
					'</thead>';
				html+=	'<tbody>'+toolsHtml+
				'</tbody></table>';
				html+="</ul>";
				$("#toolList").html(html);
			}
			
			/**
			* Function that loads a research object into a row in the html variable.
			**/
			function loadRow(tool){
				toolsHtml+='<tr>';
				toolsHtml+='<td><a href=\"'+tool.id+'\">'+tool.label+'</a></td>';
				//console.log(tool.authors);
				if(tool.authors && tool.authors.length>0){
					toolsHtml+='<td>'+tool.authors[0]+'</td>';
				}else{
					toolsHtml+='<td>undefined</td>';
				}
				/*
				if(tool.agents && tool.agents.length>0){
					toolsHtml+='<td>'+tool.agents[0].name+'</td>';
				}else{
					if(tool.creator && (typeof tool.creator == 'string' || tool.creator instanceof String)){
						toolsHtml+='<td>'+tool.creator+'</td>';
					}else{
						if(tool.creator){
							toolsHtml+='<td>'+tool.creator[0]+'</td>';
						}else{
							toolsHtml+='<td>Undefined</td>';
						}
					}
				}*/
				toolsHtml+='<td>'+tool.type+'</td>';
				toolsHtml+='<td>'+tool.description+'</td>';
				toolsHtml+='</tr>';
			}
			
	</script>

  </head>
   <body>

    <div class="container">
      <nav class="navbar navbar-inverse" role="navigation">
            <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
              <a class="navbar-brand">Distributed client</a>
            </div>
        </div>
      </nav>
	  
      <div>        
        <h3 class="text-muted">Select a server to start loading the tools stored in it</h3>
      </div>
	  
	<ul class="list-group">
		<li class="list-group-item" id="labelOntosoft">
			Server 1 (Ontosoft)
			<div class="material-switch pull-right">
				<input id="ontosoft" name="server1" type="checkbox" onchange="check()"/>
				<label class="label-default"></label>
			</div>
		</li>
		<li class="list-group-item">
			Server 2 (c4p)
			<div class="material-switch pull-right">
				<input id="c4p" name="server2" type="checkbox" onchange="check()"/>
				<label id="labelc4p" class="label-primary"></label>
			</div>
		</li>
		<li class="list-group-item">
			Server 3 (CSDM)
			<div class="material-switch pull-right">
				<input id="csdm" name="server3" type="checkbox" onchange="check()"/>
				<label id="labelCsdm" class="label-primary"></label>
			</div>
		</li>
	</ul>					
	
	<div class="panel panel-default">
	  <div class="panel-body">
		<!-- Server options-->
		
			<h3>Total tools loaded: <span id="numberOfTools">0</span></h3>	
              
		<div id="toolList">	
			Select a server to start loading tools.
		</div>
       </div>
	</div>

      <footer class="footer">
        <p>&copy; Daniel Garijo, 2016</p>
      </footer>

    </div> <!-- /container -->
    
  </body>
</html>